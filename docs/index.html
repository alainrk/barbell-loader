<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Barbell Weight Calculator</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <style>
      /* Additional styles can go here */
    </style>
  </head>
  <body>
    <div class="container py-5">
      <h2>Barbell Weight Calculator</h2>
      <form id="weightCalcForm">
        <div class="mb-3">
          <label for="barbellWeight" class="form-label"
            >Choose Barbell Weight</label
          >
          <select class="form-select" id="barbellWeight">
            <option value="10">10kg</option>
            <option value="6.5">6.5kg</option>
            <option value="0.75">0.75kg</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="targetWeight" class="form-label">Target Weight</label>
          <div class="input-group">
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="decreaseWeight"
            >
              -
            </button>
            <input
              type="number"
              class="form-control"
              id="targetWeight"
              placeholder="Enter target weight"
              step="0.25"
              required
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="increaseWeight"
            >
              +
            </button>
          </div>
        </div>
        <div class="mb-1 form-check">
          <input type="checkbox" class="form-check-input" id="allowImbalance" />
          <label class="form-check-label" for="allowImbalance"
            >Allow Imbalance</label
          >
        </div>
        <button type="submit" class="btn btn-primary">Calculate</button>
        <button type="reset" class="btn btn-secondary">Reset</button>
      </form>
      <div id="result" class="mt-4"></div>

      <!-- Disks -->

      <div class="row mt-1">
        <div class="col">
          <label for="disk20" class="form-label">20kg</label>
          <div class="input-group">
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="decrease20"
            >
              -
            </button>
            <input
              type="number"
              class="form-control"
              id="disk20"
              step="1"
              required
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="increase20"
            >
              +
            </button>
          </div>
        </div>

        <div class="col">
          <label for="disk15" class="form-label">15kg</label>
          <div class="input-group">
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="decrease15"
            >
              -
            </button>
            <input
              type="number"
              class="form-control"
              id="disk15"
              step="1"
              required
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="increase15"
            >
              +
            </button>
          </div>
        </div>
      </div>

      <div class="row mt-1">
        <div class="col">
          <label for="disk10" class="form-label">10kg</label>
          <div class="input-group">
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="decrease10"
            >
              -
            </button>
            <input
              type="number"
              class="form-control"
              id="disk10"
              step="1"
              required
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="increase10"
            >
              +
            </button>
          </div>
        </div>

        <div class="col">
          <label for="disk5" class="form-label">5kg</label>
          <div class="input-group">
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="decrease5"
            >
              -
            </button>
            <input
              type="number"
              class="form-control"
              id="disk5"
              step="1"
              required
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="increase5"
            >
              +
            </button>
          </div>
        </div>
      </div>

      <div class="row mt-1">
        <div class="col">
          <label for="disk2" class="form-label">2kg</label>
          <div class="input-group">
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="decrease2"
            >
              -
            </button>
            <input
              type="number"
              class="form-control"
              id="disk2"
              step="1"
              required
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="increase2"
            >
              +
            </button>
          </div>
        </div>

        <div class="col">
          <label for="disk1" class="form-label">1kg</label>
          <div class="input-group">
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="decrease1"
            >
              -
            </button>
            <input
              type="number"
              class="form-control"
              id="disk1"
              step="1"
              required
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="increase1"
            >
              +
            </button>
          </div>
        </div>
      </div>

      <div class="row mt-1">
        <div class="col">
          <label for="disk0.5" class="form-label">0.5kg</label>
          <div class="input-group">
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="decrease0.5"
            >
              -
            </button>
            <input
              type="number"
              class="form-control"
              id="disk0.5"
              step="1"
              required
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="increase0.5"
            >
              +
            </button>
          </div>
        </div>
        <div class="col"></div>
      </div>

      <!-- Disks -->
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script>
      // Your calculate function goes here
      function calculate(
        barbellWeight,
        targetWeight,
        availableWeights,
        allowImbalance = false
      ) {
        // Initialize weight loaders
        const res = {
          load: { left: 0, right: 0 },
          sides: {
            left: [],
            right: [],
          },
        };
        availableWeights = JSON.parse(JSON.stringify(availableWeights));
        // Remove barbell weight
        targetWeight -= barbellWeight;
        // Created a reversed sorted list of available weights
        const weights = Object.keys(availableWeights)
          .map((x) => parseFloat(x))
          .sort((a, b) => b - a);
        const minWeightAvailable = weights[weights.length - 1];
        if (targetWeight < 0) {
          throw new Error("Target weight must be greater than barbell weight");
        }
        const getNextWeight = (max = Infinity) => {
          for (const w of weights) {
            // Too heavy for what's needed OR Not enough disks of this weight
            if (w > max || availableWeights[w] < 2) {
              continue;
            }
            return w;
          }
          return 0;
        };
        while (targetWeight > 0) {
          const w = getNextWeight(targetWeight / 2);
          if (w === 0) {
            throw new Error("No available weights");
          }
          const newPotentialTarget = targetWeight - w * 2;
          // Use those disks
          availableWeights[w] -= 2;
          // Update new target
          targetWeight = newPotentialTarget;
          res.load.left += w;
          res.load.right += w;
          res.sides.left.push(w);
          res.sides.right.push(w);
          // Just perfect
          if (targetWeight === 0) {
            break;
          }
          // No available weights anymore
          if (targetWeight < minWeightAvailable * 2) {
            if (!allowImbalance) break;
            // Check if imbalance is allowed, and there is a small disk we can add it on one side and that's it
            if (
              targetWeight >= minWeightAvailable &&
              availableWeights[minWeightAvailable] > 0
            ) {
              res.load.left += minWeightAvailable;
              res.sides.left.push(minWeightAvailable);
            }
            // And in any case, exit
            break;
          }
        }
        return res;
      }

      const startWeights = {
        0.5: 4,
        1: 6,
        2: 10,
        5: 4,
        10: 6,
        15: 2,
        20: 2,
      };

      const availableWeights = JSON.parse(JSON.stringify(startWeights));

      const onChangeDisk = (disk, delta) => {
        availableWeights[disk] += delta;
        if (availableWeights[disk] < 0) availableWeights[disk] = 0;
        document.getElementById(`disk${disk}`).value = availableWeights[disk];
        console.log(availableWeights);
      };

      const onCalculate = (e) => {
        e.preventDefault();
        const barbellWeight = parseFloat(
          document.getElementById("barbellWeight").value
        );
        const targetWeight = parseFloat(
          document.getElementById("targetWeight").value
        );
        const allowImbalance =
          document.getElementById("allowImbalance").checked;

        const result = calculate(
          barbellWeight,
          targetWeight,
          availableWeights,
          allowImbalance
        );

        document.getElementById("result").innerHTML = `
        <h4>Result</h4>
        <p>Total: ${
          result.load.left + result.load.right + barbellWeight
        }kg (${barbellWeight} + [${result.load.left} + ${
          result.load.right
        }])</p>
        <p>Left: ${result.sides.left.join(" - ")}</p>
        <p>Right: ${result.sides.right.join(" - ")}</p>
      `;
      };

      const increaseWeight = () => {
        const input = document.getElementById("targetWeight");
        input.value = (parseFloat(input.value) || 0) + 0.25;
      };

      const decreaseWeight = () => {
        const input = document.getElementById("targetWeight");
        input.value = (parseFloat(input.value) || 0) - 0.25;
        if (input.value < 0) input.value = 0; // Prevent negative values
      };

      document
        .getElementById("increaseWeight")
        .addEventListener("click", (e) => {
          increaseWeight();
          onCalculate(e);
        });

      document
        .getElementById("decreaseWeight")
        .addEventListener("click", (e) => {
          decreaseWeight();
          onCalculate(e);
        });

      document
        .getElementById("weightCalcForm")
        .addEventListener("submit", onCalculate);

      for (const d in startWeights) {
        const disk = parseFloat(d);
        const amount = startWeights[d];

        document.getElementById(`disk${disk}`).value = amount;

        document
          .getElementById(`increase${d}`)
          .addEventListener("click", (e) => {
            onChangeDisk(disk, 1);
          });
        document
          .getElementById(`decrease${d}`)
          .addEventListener("click", (e) => {
            onChangeDisk(disk, -1);
          });
      }
    </script>
  </body>
</html>
